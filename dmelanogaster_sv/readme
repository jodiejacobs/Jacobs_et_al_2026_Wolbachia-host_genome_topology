1. Transfer nanopore reads from silverbullet
ref:/private/groups/russelllab/jodie/wolbachia_induced_DE/micro-c/structural_analysis_ms/reference/dmelanogaster_genome/dmel-all-chromosome-r6.63.fasta.gz
2. Map raeds and call SV's
# Environment setup
mamba create -n sv_masking -c bioconda minimap2 samtools svim bcftools
mamba activate sv_masking

# Map nanopore reads to reference
minimap2 -ax map-ont dmel-all-chromosome-r6.63.fasta.gz Dmel_all_reads.rmdup.fastq.gz | samtools sort -@ 32 -o aligned_reads.bam
samtools index aligned_reads.bam

# Call structural variants
# Call SVs with SVIM
svim alignment ./svim_output \
     aligned_reads.bam \
     dm6_reference.fasta \
     --min_sv_size 200 \
     --min_support 3 \
     --max_sv_size 100000 \
     --segment_gap_tolerance 10 \
     --sequence_alleles

3. Filter and convert to BED
# Filter high-quality SVs
bcftools filter -i 'QUAL>=10 && INFO/SUPPORT>=3' svim_output/variants.vcf > filtered_svs.vcf

# Convert to BED format
python3 svim_to_bed.py filtered_svs.vcf sv_regions.bed
